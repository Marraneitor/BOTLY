<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Botly ‚Äî Dashboard</title>
    <link rel="icon" type="image/png" href="./images/logo.png">
    <link rel="stylesheet" href="./styles.css">
    <!-- Socket.io client (CDN ‚Äî only used when backend is running) -->
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js" defer crossorigin="anonymous"></script>
    <!-- QRCode.js for rendering QR codes on a canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" defer crossorigin="anonymous"></script>
    <!-- Firebase Auth SDK (needed for signOut on logout) -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="./client.js" defer></script>
    <!-- Google Fonts ‚Äì Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- ========== SIDEBAR ========== -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar__brand">
            <img class="sidebar__logo" src="./images/logo.png" alt="Botly">
            <span>Botly</span>
        </div>

        <nav class="sidebar__nav">
            <a href="#" class="sidebar__link sidebar__link--active" data-section="dashboard">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
                Dashboard
            </a>
            <a href="#" class="sidebar__link" data-section="config">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
                Configuraci√≥n
            </a>
            <a href="#" class="sidebar__link" data-section="connection">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
                Conexi√≥n
            </a>
            <a href="#" class="sidebar__link" data-section="messages">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                Mensajes
            </a>
            <a href="#" class="sidebar__link" data-section="plans">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
                Planes
            </a>
            <a href="#" class="sidebar__link" data-section="ventas">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
                Ventas
                <span class="sidebar__beta-badge">Beta</span>
            </a>
            <a href="#" class="sidebar__link sidebar__link--admin" id="admin-link" data-section="admin" style="display:none;">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 15v2m-6 4h12a2 2 0 0 0 2-2v-6a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2zm10-10V7a4 4 0 0 0-8 0v4h8z"/></svg>
                Admin
            </a>
        </nav>

        <div class="sidebar__footer">
            <button class="sidebar__logout" id="btn-logout">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                Cerrar sesi√≥n
            </button>
        </div>
    </aside>

    <!-- Mobile hamburger -->
    <button class="hamburger" id="hamburger" aria-label="Abrir men√∫">
        <span></span><span></span><span></span>
    </button>

    <!-- ========== MAIN CONTENT ========== -->
    <main class="main">
        <!-- ---- SECTION: Dashboard ---- -->
        <section class="section" id="section-dashboard">
            <h1 class="section__title">Dashboard</h1>
            <div class="cards">
                <div class="card card--status" id="card-status">
                    <div class="card__icon card__icon--disconnected" id="status-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/></svg>
                    </div>
                    <div class="card__body">
                        <span class="card__label">Estado del Bot</span>
                        <strong class="card__value" id="status-text">Desconectado</strong>
                    </div>
                </div>
                <div class="card">
                    <div class="card__icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                    </div>
                    <div class="card__body">
                        <span class="card__label">Mensajes hoy</span>
                        <strong class="card__value" id="messages-today">0</strong>
                    </div>
                </div>
                <div class="card">
                    <div class="card__icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>
                    </div>
                    <div class="card__body">
                        <span class="card__label">Contactos atendidos</span>
                        <strong class="card__value" id="contacts-count">0</strong>
                    </div>
                </div>
            </div>

            <div class="quick-actions">
                <h2 class="quick-actions__title">Acciones r√°pidas</h2>
                <button class="btn btn--primary" data-goto="config">Editar configuraci√≥n</button>
                <button class="btn btn--success" data-goto="connection">Ver conexi√≥n QR</button>
            </div>
        </section>

        <!-- ---- SECTION: Configuraci√≥n del Bot ---- -->
        <section class="section section--hidden" id="section-config">
            <h1 class="section__title">Configuraci√≥n del Bot</h1>
            <p class="section__subtitle">Personaliza c√≥mo tu bot responde a tus clientes.</p>

            <form class="form" id="config-form" autocomplete="off">
                <!-- Nombre del negocio -->
                <div class="form__group">
                    <label class="form__label" for="businessName">Nombre del negocio</label>
                    <input class="form__input" type="text" id="businessName" name="businessName" placeholder="Ej: Pizzer√≠a Don Mario" required>
                </div>

                <!-- Descripci√≥n del negocio -->
                <div class="form__group">
                    <label class="form__label" for="businessDescription">Descripci√≥n del negocio</label>
                    <textarea class="form__textarea" id="businessDescription" name="businessDescription" rows="3" placeholder="Breve descripci√≥n de lo que ofreces..."></textarea>
                </div>

                <!-- Horarios de atenci√≥n -->
                <fieldset class="form__fieldset">
                    <legend class="form__legend">Horarios de atenci√≥n</legend>
                    <div class="schedule-grid">
                        <div class="schedule-row" data-day="lunes">
                            <label class="schedule-row__day">Lunes</label>
                            <input class="form__input form__input--sm" type="time" name="schedule_lunes_open" value="09:00">
                            <span class="schedule-row__sep">a</span>
                            <input class="form__input form__input--sm" type="time" name="schedule_lunes_close" value="18:00">
                            <label class="toggle"><input type="checkbox" name="schedule_lunes_active" checked><span class="toggle__slider"></span></label>
                        </div>
                        <div class="schedule-row" data-day="martes">
                            <label class="schedule-row__day">Martes</label>
                            <input class="form__input form__input--sm" type="time" name="schedule_martes_open" value="09:00">
                            <span class="schedule-row__sep">a</span>
                            <input class="form__input form__input--sm" type="time" name="schedule_martes_close" value="18:00">
                            <label class="toggle"><input type="checkbox" name="schedule_martes_active" checked><span class="toggle__slider"></span></label>
                        </div>
                        <div class="schedule-row" data-day="miercoles">
                            <label class="schedule-row__day">Mi√©rcoles</label>
                            <input class="form__input form__input--sm" type="time" name="schedule_miercoles_open" value="09:00">
                            <span class="schedule-row__sep">a</span>
                            <input class="form__input form__input--sm" type="time" name="schedule_miercoles_close" value="18:00">
                            <label class="toggle"><input type="checkbox" name="schedule_miercoles_active" checked><span class="toggle__slider"></span></label>
                        </div>
                        <div class="schedule-row" data-day="jueves">
                            <label class="schedule-row__day">Jueves</label>
                            <input class="form__input form__input--sm" type="time" name="schedule_jueves_open" value="09:00">
                            <span class="schedule-row__sep">a</span>
                            <input class="form__input form__input--sm" type="time" name="schedule_jueves_close" value="18:00">
                            <label class="toggle"><input type="checkbox" name="schedule_jueves_active" checked><span class="toggle__slider"></span></label>
                        </div>
                        <div class="schedule-row" data-day="viernes">
                            <label class="schedule-row__day">Viernes</label>
                            <input class="form__input form__input--sm" type="time" name="schedule_viernes_open" value="09:00">
                            <span class="schedule-row__sep">a</span>
                            <input class="form__input form__input--sm" type="time" name="schedule_viernes_close" value="18:00">
                            <label class="toggle"><input type="checkbox" name="schedule_viernes_active" checked><span class="toggle__slider"></span></label>
                        </div>
                        <div class="schedule-row" data-day="sabado">
                            <label class="schedule-row__day">S√°bado</label>
                            <input class="form__input form__input--sm" type="time" name="schedule_sabado_open" value="10:00">
                            <span class="schedule-row__sep">a</span>
                            <input class="form__input form__input--sm" type="time" name="schedule_sabado_close" value="14:00">
                            <label class="toggle"><input type="checkbox" name="schedule_sabado_active" checked><span class="toggle__slider"></span></label>
                        </div>
                        <div class="schedule-row" data-day="domingo">
                            <label class="schedule-row__day">Domingo</label>
                            <input class="form__input form__input--sm" type="time" name="schedule_domingo_open" value="00:00">
                            <span class="schedule-row__sep">a</span>
                            <input class="form__input form__input--sm" type="time" name="schedule_domingo_close" value="00:00">
                            <label class="toggle"><input type="checkbox" name="schedule_domingo_active"><span class="toggle__slider"></span></label>
                        </div>
                    </div>
                </fieldset>

                <!-- Men√∫ de productos/servicios -->
                <div class="form__group">
                    <label class="form__label" for="menu">Men√∫ de productos / servicios</label>
                    <textarea class="form__textarea form__textarea--lg" id="menu" name="menu" rows="10" placeholder="Escribe tu men√∫ aqu√≠. Ejemplo:&#10;üçï Pizza Margarita ‚Äî $8.00&#10;üçï Pizza Pepperoni ‚Äî $9.50&#10;ü•§ Refresco 500ml ‚Äî $2.00"></textarea>
                </div>

                <!-- Prompt personalizado -->
                <div class="form__group">
                    <label class="form__label" for="botPrompt">Contexto / Personalidad del Bot (Prompt para Gemini)</label>
                    <textarea class="form__textarea form__textarea--lg" id="botPrompt" name="botPrompt" rows="8" placeholder="Ej: Eres un asistente amable de la Pizzer√≠a Don Mario. Responde en espa√±ol, s√© breve y ofrece el men√∫ cuando te lo pidan..."></textarea>
                    <span class="form__hint">Este texto se env√≠a a Gemini como instrucciones del sistema. Define el tono, idioma y comportamiento del bot.</span>
                </div>

                <!-- Actions -->
                <div class="form__actions">
                    <button type="submit" class="btn btn--primary btn--lg" id="btn-save">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                        Guardar configuraci√≥n
                    </button>
                    <button type="button" class="btn btn--ghost" id="btn-reset-draft">Descartar borrador</button>
                </div>
            </form>

            <!-- Toast notification -->
            <div class="toast" id="toast" role="alert"></div>
        </section>

        <!-- ---- SECTION: Conexi√≥n WhatsApp ---- -->
        <section class="section section--hidden" id="section-connection">
            <h1 class="section__title">Conexi√≥n WhatsApp</h1>
            <p class="section__subtitle">Escanea el c√≥digo QR con tu app de WhatsApp para vincular el bot.</p>

            <div class="connection-panel">
                <div class="qr-container" id="qr-container">
                    <div class="qr-placeholder" id="qr-placeholder">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="qr-placeholder__icon">
                            <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><circle cx="17.5" cy="17.5" r="3.5"/>
                        </svg>
                        <p>Esperando c√≥digo QR‚Ä¶</p>
                        <span class="qr-placeholder__hint">Aseg√∫rate de haber guardado tu configuraci√≥n primero.</span>
                    </div>
                    <div id="qr-canvas" class="qr-canvas qr-canvas--hidden"></div>
                </div>

                <div class="connection-info">
                    <div class="connection-status" id="connection-status">
                        <span class="status-dot status-dot--off" id="conn-dot"></span>
                        <span id="conn-label">Desconectado</span>
                    </div>

                    <div class="connection-steps">
                        <h3>Instrucciones</h3>
                        <ol>
                            <li>Guarda tu configuraci√≥n en la secci√≥n anterior.</li>
                            <li>Haz clic en <strong>"Iniciar Bot"</strong> abajo.</li>
                            <li>Abre WhatsApp en tu tel√©fono.</li>
                            <li>Ve a <strong>Ajustes ‚Üí Dispositivos vinculados ‚Üí Vincular dispositivo</strong>.</li>
                            <li>Escanea el c√≥digo QR que aparecer√° aqu√≠.</li>
                        </ol>
                    </div>

                    <div class="connection-actions">
                        <button class="btn btn--success btn--lg" id="btn-start-bot">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                            Iniciar Bot
                        </button>
                        <button class="btn btn--danger" id="btn-stop-bot" disabled>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="6" y="6" width="12" height="12"/></svg>
                            Detener Bot
                        </button>
                        <button class="btn btn--warning" id="btn-reset-bot">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6"/><path d="M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
                            Formatear dispositivos (nuevo QR)
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- ---- SECTION: Mensajes (Inbox) ---- -->
        <section class="section section--hidden" id="section-messages">
            <!-- INBOX VIEW: conversations list -->
            <div id="inbox-view">
                <div class="inbox-header">
                    <h1 class="section__title">Conversaciones</h1>
                    <div class="inbox-header__actions">
                        <!-- Response mode toggle -->
                        <div class="response-mode-toggle" id="response-mode-toggle">
                            <span class="response-mode-label" id="response-mode-label">Autom√°tico</span>
                            <label class="toggle">
                                <input type="checkbox" id="response-mode-switch">
                                <span class="toggle__slider"></span>
                            </label>
                            <span class="response-mode-label response-mode-label--alt" id="response-mode-label-alt">Semi-auto</span>
                        </div>
                        <input class="form__input inbox-search" type="text" id="inbox-search" placeholder="Buscar contacto...">
                        <button class="btn btn--danger btn--sm" id="btn-clear-messages">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                            Borrar todo
                        </button>
                    </div>
                </div>

                <!-- Pending message alert (semi-auto mode) -->
                <div class="pending-alert pending-alert--hidden" id="pending-alert">
                    <div class="pending-alert__icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
                    </div>
                    <div class="pending-alert__body">
                        <strong id="pending-alert-name">Contacto</strong>
                        <p id="pending-alert-text">Mensaje pendiente...</p>
                    </div>
                    <div class="pending-alert__actions">
                        <button class="btn btn--primary btn--sm" id="btn-approve-reply">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><path d="M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20z"/><path d="M12 8v4l3 3"/></svg>
                            Responder con Bot
                        </button>
                        <button class="btn btn--outline btn--sm" id="btn-manual-reply">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                            Responder manual
                        </button>
                        <button class="btn btn--ghost btn--sm" id="btn-dismiss-alert">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                        </button>
                    </div>
                </div>

                <div class="inbox-empty" id="inbox-empty">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                    <p>No hay conversaciones a√∫n.</p>
                    <span>Los mensajes aparecer√°n aqu√≠ cuando alguien escriba al bot.</span>
                </div>

                <div class="inbox-list" id="inbox-list"></div>
            </div>

            <!-- CHAT VIEW: single conversation -->
            <div id="chat-view" class="chat-view chat-view--hidden">
                <div class="chat-topbar">
                    <button class="btn btn--ghost btn--icon" id="btn-back-inbox">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
                    </button>
                    <div class="chat-topbar__info">
                        <span class="chat-topbar__name" id="chat-contact-name">Contacto</span>
                        <span class="chat-topbar__phone" id="chat-contact-phone">+00 000 000 0000</span>
                    </div>
                    <div class="chat-topbar__status">
                        <button class="btn btn--ghost btn--sm chat-pause-btn" id="btn-pause-chat" title="Pausar bot en este chat">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>
                            <span id="pause-btn-label">Pausar</span>
                        </button>
                        <span class="status-dot status-dot--on" id="chat-bot-dot"></span>
                        <span id="chat-bot-label">Bot activo</span>
                    </div>
                </div>

                <div class="chat-messages" id="chat-messages"></div>

                <div class="chat-input-bar">
                    <textarea class="chat-input" id="chat-input" rows="1" placeholder="Escribe un mensaje manual..."></textarea>
                    <button class="btn btn--primary btn--icon" id="btn-send-message">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
                    </button>
                </div>
            </div>
        </section>

        <!-- ---- SECTION: Planes / Suscripci√≥n ---- -->
        <section class="section section--hidden" id="section-plans">
            <h1 class="section__title">Planes</h1>
            <p class="section__subtitle">Elige el plan que mejor se adapte a tu negocio.</p>

            <!-- Subscription status banner -->
            <div class="sub-status" id="sub-status" style="display:none;">
                <div class="sub-status__icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                </div>
                <div class="sub-status__info">
                    <strong id="sub-status-plan">Plan Activo</strong>
                    <span id="sub-status-expires">Expira: --</span>
                </div>
                <span class="sub-status__badge" id="sub-status-badge">Activo</span>
            </div>

            <!-- Plans grid -->
            <div class="plans-grid">
                <!-- Plan Mensual -->
                <div class="plan-card" data-plan="monthly">
                    <div class="plan-card__header">
                        <h3 class="plan-card__name">Mensual</h3>
                        <p class="plan-card__desc">Ideal para probar Botly</p>
                    </div>
                    <div class="plan-card__price">
                        <span class="plan-card__amount">$79</span>
                        <span class="plan-card__currency">MXN / mes</span>
                    </div>
                    <ul class="plan-card__features">
                        <li><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg> Bot de WhatsApp con IA</li>
                        <li><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg> Mensajes ilimitados</li>
                        <li><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg> Dashboard completo</li>
                        <li><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg> 1 mes de acceso</li>
                    </ul>
                    <button class="btn btn--outline btn--block btn-subscribe" data-plan="monthly">
                        Suscribirse
                    </button>
                </div>

                <!-- Plan Trimestral -->
                <div class="plan-card plan-card--popular" data-plan="quarterly">
                    <div class="plan-card__badge">+1 mes gratis</div>
                    <div class="plan-card__header">
                        <h3 class="plan-card__name">Trimestral</h3>
                        <p class="plan-card__desc">El m√°s popular</p>
                    </div>
                    <div class="plan-card__price">
                        <span class="plan-card__amount">$237</span>
                        <span class="plan-card__currency">MXN / 3 meses</span>
                    </div>
                    <div class="plan-card__savings">Pagas 3, recibes 4 meses</div>
                    <ul class="plan-card__features">
                        <li><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg> Bot de WhatsApp con IA</li>
                        <li><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg> Mensajes ilimitados</li>
                        <li><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg> Dashboard completo</li>
                        <li><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg> 4 meses de acceso</li>
                        <li><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg> <strong>1 mes de regalo</strong></li>
                    </ul>
                    <button class="btn btn--primary btn--block btn-subscribe" data-plan="quarterly">
                        Suscribirse ‚Äî M√°s popular
                    </button>
                </div>

                <!-- Plan Anual -->
                <div class="plan-card" data-plan="yearly">
                    <div class="plan-card__badge plan-card__badge--gold">+6 meses gratis</div>
                    <div class="plan-card__header">
                        <h3 class="plan-card__name">Anual</h3>
                        <p class="plan-card__desc">Mejor valor</p>
                    </div>
                    <div class="plan-card__price">
                        <span class="plan-card__amount">$948</span>
                        <span class="plan-card__currency">MXN / a√±o</span>
                    </div>
                    <div class="plan-card__savings">Pagas 12, recibes 18 meses</div>
                    <ul class="plan-card__features">
                        <li><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg> Bot de WhatsApp con IA</li>
                        <li><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg> Mensajes ilimitados</li>
                        <li><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg> Dashboard completo</li>
                        <li><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg> 18 meses de acceso</li>
                        <li><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg> <strong>6 meses de regalo</strong></li>
                    </ul>
                    <button class="btn btn--outline btn--block btn-subscribe" data-plan="yearly">
                        Suscribirse ‚Äî Mejor valor
                    </button>
                </div>
            </div>

            <!-- Payment method info -->
            <div class="plans-footer">
                <div class="plans-footer__secure">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                    <span>Pago seguro con Stripe. Aceptamos Visa, Mastercard, AMEX y m√°s.</span>
                </div>
            </div>
        </section>

        <!-- ---- SECTION: Ventas (Beta) ---- -->
        <section class="section section--hidden" id="section-ventas">
            <div class="ventas-header">
                <div class="ventas-header__left">
                    <h1 class="section__title">
                        Ventas &amp; Oportunidades
                        <span class="beta-tag">Beta</span>
                    </h1>
                    <p class="section__subtitle">An√°lisis inteligente de tus conversaciones para detectar ventas, citas y oportunidades.</p>
                </div>
                <div class="ventas-header__actions">
                    <button class="btn btn--primary btn--lg" id="btn-analyze-ventas">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
                        Analizar conversaciones
                    </button>
                </div>
            </div>

            <!-- Stats summary cards -->
            <div class="ventas-stats" id="ventas-stats" style="display:none;">
                <div class="ventas-stat-card ventas-stat-card--sales">
                    <div class="ventas-stat-card__icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
                    </div>
                    <div class="ventas-stat-card__body">
                        <span class="ventas-stat-card__value" id="ventas-total-sales">0</span>
                        <span class="ventas-stat-card__label">Ventas detectadas</span>
                    </div>
                </div>
                <div class="ventas-stat-card ventas-stat-card--appointments">
                    <div class="ventas-stat-card__icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                    </div>
                    <div class="ventas-stat-card__body">
                        <span class="ventas-stat-card__value" id="ventas-total-appointments">0</span>
                        <span class="ventas-stat-card__label">Citas agendadas</span>
                    </div>
                </div>
                <div class="ventas-stat-card ventas-stat-card--leads">
                    <div class="ventas-stat-card__icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                    </div>
                    <div class="ventas-stat-card__body">
                        <span class="ventas-stat-card__value" id="ventas-total-leads">0</span>
                        <span class="ventas-stat-card__label">Leads interesados</span>
                    </div>
                </div>
                <div class="ventas-stat-card ventas-stat-card--conversations">
                    <div class="ventas-stat-card__icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                    </div>
                    <div class="ventas-stat-card__body">
                        <span class="ventas-stat-card__value" id="ventas-total-analyzed">0</span>
                        <span class="ventas-stat-card__label">Conversaciones analizadas</span>
                    </div>
                </div>
            </div>

            <!-- Loading state -->
            <div class="ventas-loading" id="ventas-loading" style="display:none;">
                <div class="ventas-loading__spinner"></div>
                <p class="ventas-loading__text">Analizando conversaciones con IA...</p>
                <p class="ventas-loading__subtext">Esto puede tomar unos segundos</p>
            </div>

            <!-- Empty state -->
            <div class="ventas-empty" id="ventas-empty">
                <div class="ventas-empty__icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" width="64" height="64">
                        <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                    </svg>
                </div>
                <h3>Descubre tus ventas ocultas</h3>
                <p>Haz clic en <strong>"Analizar conversaciones"</strong> para que la IA revise tus chats de WhatsApp y detecte ventas, citas y oportunidades de negocio.</p>
            </div>

            <!-- Results list -->
            <div class="ventas-results" id="ventas-results" style="display:none;">
                <div class="ventas-results__header">
                    <h2>Resultados del an√°lisis</h2>
                    <div class="ventas-results__filters">
                        <button class="ventas-filter ventas-filter--active" data-filter="all">Todos</button>
                        <button class="ventas-filter" data-filter="sale">Ventas</button>
                        <button class="ventas-filter" data-filter="appointment">Citas</button>
                        <button class="ventas-filter" data-filter="lead">Leads</button>
                        <button class="ventas-filter" data-filter="no_result">Sin resultado</button>
                    </div>
                </div>
                <div class="ventas-list" id="ventas-list"></div>
            </div>
        </section>

        <!-- ---- SECTION: Admin Panel ---- -->
        <section class="section section--hidden" id="section-admin">
            <h1 class="section__title">
                Panel de Administraci√≥n
                <span class="admin-inline-badge">ADMIN</span>
            </h1>
            <p class="section__subtitle">Gestiona usuarios, suscripciones y conversaciones.</p>

            <!-- Admin KPI cards -->
            <div class="admin-kpi-row" id="admin-kpi-row">
                <div class="admin-kpi">
                    <span class="admin-kpi__val" id="admin-kpi-total">‚Äî</span>
                    <span class="admin-kpi__label">Usuarios totales</span>
                </div>
                <div class="admin-kpi admin-kpi--green">
                    <span class="admin-kpi__val" id="admin-kpi-active">‚Äî</span>
                    <span class="admin-kpi__label">Suscripciones activas</span>
                </div>
                <div class="admin-kpi admin-kpi--red">
                    <span class="admin-kpi__val" id="admin-kpi-expired">‚Äî</span>
                    <span class="admin-kpi__label">Expiradas</span>
                </div>
                <div class="admin-kpi admin-kpi--blue">
                    <span class="admin-kpi__val" id="admin-kpi-bots">‚Äî</span>
                    <span class="admin-kpi__label">Bots activos</span>
                </div>
            </div>

            <!-- Users table -->
            <div class="admin-users-card">
                <div class="admin-users-card__header">
                    <h2>Usuarios registrados</h2>
                    <button class="btn btn--sm btn--outline" id="btn-admin-refresh">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
                        Actualizar
                    </button>
                </div>
                <div class="admin-users-table-wrap">
                    <table class="admin-users-table" id="admin-users-table">
                        <thead>
                            <tr>
                                <th>Usuario</th>
                                <th>Plan</th>
                                <th>Estado</th>
                                <th>Tiempo restante</th>
                                <th>Bot</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="admin-users-tbody"></tbody>
                    </table>
                </div>
            </div>

            <!-- User detail modal (conversations + gift) -->
            <div class="admin-modal-overlay" id="admin-user-modal" style="display:none;">
                <div class="admin-modal">
                    <div class="admin-modal__header">
                        <h2 id="admin-modal-title">Detalles del usuario</h2>
                        <button class="admin-modal__close" id="admin-modal-close">&times;</button>
                    </div>
                    <div class="admin-modal__body">
                        <!-- User info -->
                        <div class="admin-modal__info" id="admin-modal-info"></div>

                        <!-- Gift time -->
                        <div class="admin-modal__gift">
                            <h3>üéÅ Regalar tiempo</h3>
                            <div class="admin-gift-btns">
                                <button class="btn btn--sm btn--outline admin-gift-btn" data-gift="1day">+1 D√≠a</button>
                                <button class="btn btn--sm btn--outline admin-gift-btn" data-gift="1week">+1 Semana</button>
                                <button class="btn btn--sm btn--primary admin-gift-btn" data-gift="1month">+1 Mes</button>
                            </div>
                            <p class="admin-gift-result" id="admin-gift-result"></p>
                        </div>

                        <!-- Conversations -->
                        <div class="admin-modal__convos">
                            <h3>üí¨ Conversaciones (<span id="admin-convos-count">0</span>)</h3>
                            <div class="admin-convos-loading" id="admin-convos-loading" style="display:none;">
                                <div class="admin-convos-spinner"></div> Cargando...
                            </div>
                            <div class="admin-convos-list" id="admin-convos-list"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- ========== TRIAL / SUBSCRIPTION EXPIRED MODAL ========== -->
    <div class="trial-modal-overlay" id="trial-modal" style="display:none;">
        <div class="trial-modal">
            <div class="trial-modal__icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="48" height="48">
                    <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
            </div>
            <h2 class="trial-modal__title" id="trial-modal-title">Tu prueba gratuita ha expirado</h2>
            <p class="trial-modal__text" id="trial-modal-text">
                Suscr√≠bete a un plan para seguir usando Botly y mantener tu bot activo.
            </p>
            <button class="btn btn--primary btn--lg" id="trial-modal-btn" onclick="document.getElementById('trial-modal').style.display='none'; document.querySelector('[data-section=plans]').click();">
                Ver planes y suscribirse
            </button>
        </div>
    </div>

    <!-- ========== TRIAL BANNER (floating) ========== -->
    <div class="trial-banner" id="trial-banner" style="display:none;">
        <span id="trial-banner-text">üéÅ Prueba gratuita: te quedan <strong id="trial-hours-left">24</strong> horas</span>
        <button class="btn btn--sm btn--primary" onclick="document.querySelector('[data-section=plans]').click();">Ver planes</button>
    </div>
</body>
</html>
